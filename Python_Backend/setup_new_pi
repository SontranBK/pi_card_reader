"""""""""""""""""
1) before you start lauching following commands, do this 
when you flash Raspberry Pi Ubuntu SD Card:
"""""""""""""""""
sudo nano /boot/firmware/config.txt

- Or find file with name: config.txt

- Identify the following line:

dtoverlay=vc4-kms-v3d

- And change it to:

dtoverlay=vc4-fkms-v3d

"""""""""""""""""
2) Initialize reader, operating system and source code
"""""""""""""""""
2.1) install setting for Ubuntu system, set user name to "metaedu", password to 1
- Choose Location: Ho Chi Minh
- Language/ keyboard: English US
- Your name, user, desktop name: metaedu
- Choose "auto login" => Must auto login

2.2) download this source code from github and put it in "home" folder
2.3) change the name of main folder to "pi_card_reader"

2.4) Open window computer, open software DEDOWNLOADER, connect to reader, and open firmware
DE-620L_950_DualCard_161227 (1)
Then click "FW file down" to write this firmware to our reader
"""""""""""""""""
3) Open Terminal and run those command to install dependencies:
if there's issue with "Could not get lock /var/cache/apt/archives/lock, or process is hold, ...", 
here is the solution: https://itsfoss.com/fix-ubuntu-install-error/

cd into /var/lib/dpkg/ and remove lock-fontend by: rm lock-fontend
"""""""""""""""""
cd ~
sudo apt install --assume-yes chromium-browser
cd ~
sudo apt install python3-pip
cd ~
sudo pip install pyserial
cd ~
sudo python3 -m pip install firebase-admin
cd ~
sudo apt install linux-modules-extra-raspi
cd ~
sudo apt-get install python3-tk
cd ~
sudo apt remove brltty
cd ~
sudo apt-get install minicom
sudo minicom -s

""""""""""""""""""
""""""""""""""""""
- Run minicom with sudo minicom -s, go to "Serial port setup" 
- Change the first line to /dev/ttyUSB0.
- Save config as default with "Save setup as dfl". 
- Restart your Pi
""""""""""""""""""
""""""""""""""""""

lsusb

### use lsusb to check vendor and product id
sudo modprobe usbserial vendor=1a86 product=7532

### If above line "sudo modprobe usbserial vendor=1a86 product=7532" doesn't work
### For some reason, some reader need to add 0x in font of id, eg:
sudo modprobe usbserial vendor=0x31aa product=0x3000

### Then use following line to check if ports are open:
sudo python3 -m serial.tools.list_ports
### If everything works well, the terminal output should show "/dev/ttyUSB0" as a port
### If not run "sudo apt remove brltty" again

cd ~
sudo snap install flutter --classic
cd ~
cd pi_card_reader/
sudo flutter config --enable-web
sudo flutter create --platforms=web .
sudo flutter build web
//sudo flutter pub add firebase_messaging
//sudo flutter pub upgrade firebase_messaging
//sudo flutter pub upgrade

"""""""""""""""""
4) Make system auto-boot and auto-config 
"""""""""""""""""
4.1) Click "show application" or "activities", type in "Startup Application" and open it, then click "Add", then set:
- Name: terminal
- Command: click "browser", then find following path: "/user/bin/gnome-terminal.real"

now right-click Terminal and open Preferences: 
- change the name of current profile to "Debug"
- add new Profiles named "Meta_edu" and click down arrow, then choose "Set as default"
- now navigate to "Command" tab in profile "Meta_edu", choose both "Run command as a login shell" and "Run custom command instead of my shell"
- add line "sh ./pi_card_reader/Bash_Script/auto_boot.sh" to Custom command
- if possible, in "Text" tab, set "Initial terminal size" to 100 columns and 100 rows

4.2) Install "Autohide Downloads Bar" extension for chromium here (https://chrome.google.com/webstore/detail/autohide-downloads-bar/iaefpjibipfaofmigecedfapfgplmplo)
and set "Delay Timer" of this extension to 0.

4.3) Go to Chromium setting (chrome://settings/content/notifications), in "Allowed to send notifications" part, add link: http://localhost:41200
4.4) Go to Setting (of Ubuntu) => Appearance => Enable "Auto-hide the Dock"
4.5) Go to Setting (of Ubuntu) => Power => Power Saving Options => Change to "Never" 
(Make Ubuntu never goes to "sleep" mode)


"""""""""""""""""
5) Change the apperance of Ubuntu, make our product commercialized  
"""""""""""""""""
5.1) Bootup apperance: Install plymouth with following command:

cd ~
sudo apt install plymouth-themes
cd ~
sudo cp pi_card_reader/Ubuntu_Bootup_Modification/bgrt-fallback.png /usr/share/plymouth/themes/spinner
cd ~
sudo cp pi_card_reader/Ubuntu_Bootup_Modification/watermark.png /usr/share/plymouth/themes/spinner
reboot

5.2) Install virtual keyboard on device (screen keyboard)

- Open Setting on Ubuntu
- Choose Accessibility
- In Typing section -> Turn "Screen Keyboard" to "on" 



